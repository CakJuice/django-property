{% extends 'main_layout.html' %}

{% block title %}Create Mail{% endblock %}

{% block content %}
    <div class="row justify-content-center">
        <div class="col-lg-10 col-md-12">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title">Email</h3>
                    <form method="POST" novalidate>
                        {% csrf_token %}
                        {% include 'includes/form.html' %}
                        <input type="file" id="file_attachment" name="attachment" class="hidden">
                        <div class="form-group">
                            <button type="button" class="btn btn-success" id="btn_mail_attachment">Add Attachment</button>
                        </div>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_script %}
    <script type="text/javascript">
        $(function() {
            $('#btn_mail_attachment').click(function() {
                $('#file_attachment').trigger('click');
            });

            var fileInput = document.getElementById('file_attachment');
            $('#file_attachment').change(function() {
                var formData = new FormData();
                formData.append('attachment', this.files[0]);
                $.ajax({
                    method: 'POST',
                    url: '/mail/attachment/create/',
                    contentType: false,
                    processData: false,
                    dataType: 'json',
                    data: formData,
                }).done(function(response) {
                    console.log(response);
                });
            });

            $('#id_body').trumbowyg({
                btns: [
                    ['viewHTML'],
                    ['undo', 'redo'], // Only supported in Blink browsers
                    ['strong', 'em', 'del'],
                    ['superscript', 'subscript'],
                ]
            });
        });
    </script>
{% endblock %}
